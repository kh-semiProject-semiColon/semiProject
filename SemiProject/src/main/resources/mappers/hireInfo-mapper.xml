<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.co.semi.board.model.mapper.HireBoardMapper">
	
	<!-- 게시글 수 조회 -->
	<select id="getListCount">
	 SELECT COUNT(*)
	 FROM "HIRE_INFO"
	 WHERE HIRE_DEL_FL = 'N'
	</select>
	
	<!-- 지정된 페이지 목록 조회 -->
	<select id="selecHireBoardList">
	 SELECT HIRE_NO, HIRE_TITLE, HIRE_READ_COUNT, HIRE_CONTENT, 
	 		MEMBER_NICKNAME, PROFILE_IMG, STUDY_MAIN_IMG, 
	 
	  <![CDATA[
		 CASE
			WHEN SYSDATE - HIRE_DATE < 1 / 24 / 60
			THEN FLOOR((SYSDATE - HIRE_DATE) *24 *60 *60) || '초 전'
			
			WHEN SYSDATE - HIRE_DATE < 1 / 24
			THEN FLOOR((SYSDATE - HIRE_DATE) *24 * 60) || '분 전'
			
			WHEN SYSDATE - HIRE_DATE < 1
			THEN FLOOR((SYSDATE - HIRE_DATE) *24) || '시간 전'
		 ELSE TO_CHAR(HIRE_DATE, 'YYYY-MM-DD')
		 END HIRE_DATE
	 ]]>
	 
	 FROM "HIRE_INFO" H
	 JOIN "MEMBER" M ON(H.MEMBER_NO = M.MEMBER_NO)
	 JOIN "STUDY" S ON (H.STUDY_NO  = S.STUDY_NO)
	 WHERE HIRE_DEL_FL = 'N'
	 ORDER BY HIRE_NO DESC
	</select>
	
	<!-- 내 스터디 조회 -->
	<select id="showStudySelect">
	 SELECT S.*
	 FROM STUDY_MEMBER SM
	 JOIN STUDY S ON SM.STUDY_NO = S.STUDY_NO
	 WHERE SM.MEMBER_NO = #{memberNo}
	 AND S.STUDY_DEL_FL = 'N'
	</select>
	
	<!-- 구인 게시글 작성 -->
  	<insert id="writeHireBoardInsert" useGeneratedKeys="true" parameterType="HireInfo">

 		<selectKey order="BEFORE" resultType="_int" keyProperty="hireNo">
 			SELECT SEQ_BOARD_NO.NEXTVAL FROM DUAL
 		</selectKey>
 			INSERT INTO "HIRE_INFO"
 			VALUES(#{hireNo}, DEFAULT, DEFAULT,
 			DEFAULT, #{memberNo}, DEFAULT, #{hireContent},
 			#{studyNo}, #{dayCanJoin}, #{hireCount}, #{hireTitle})
  	</insert>

	<!-- 구인 게시글 상세 조회 -->
	<select id="selectOne">
	 SELECT HIRE_NO, HIRE_TITLE, HIRE_CONTENT, STUDY_NO, HIRE_READ_COUNT,
	 MEMBER_NO, MEMBER_NICKNAME, PROFILE_IMG, MEMBER_NICKNAME, STUDY_NO, DAY_CAN_JOIN, HIRE_COUNT,
	 TO_CHAR(HIRE_DATE, 'YYYY"년" MM"월" DD"일" HH24:MI:SS') HIRE_DATE,
	 TO_CHAR(HIRE_UPDATE, 'YYYY"년" MM"월" DD"일" HH24:MI:SS') HIRE_UPDATE
	
	 FROM "MEMBER"
	 JOIN "HIRE_INFO" USING(MEMBER_NO)
	 WHERE HIRE_DEL_FL = 'N'
	 AND HIRE_NO = #{hireNo}
	</select>
	
	<!-- 조회 수 1 증가 -->
	<update id="updateHireReadCount">
	 UPDATE "HIRE_INFO" SET
	 HIRE_READ_COUNT =HIRE_READ_COUNT + 1
	 WHERE HIRE_NO = #{hireNo}
	</update>
	
	<!-- 구인 게시글 스터디 조회 -->
	<select id="selectStudyNo">
	 SELECT STUDY_NAME, STUDY_MAX_COUNT, STUDY_TYPE, STUDY_PERIOD
	 FROM "STUDY"
	 WHERE STUDY_DEL_FL = 'N'
	 AND STUDY_NO = #{studyNo}
	</select>
	
</mapper>
